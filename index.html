<!DOCTYPE html><html><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content=""><meta name="keywords" content=""><meta name="author" content="OJR,undefined"><meta name="copyright" content="OJR"><title>OJR</title><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css?version=1.5.4"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  localSearch: undefined
} </script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="author-info"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">OJR</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">13</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">1</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">6</span></a></div></div></div><nav id="nav" style="background-image: url(undefined)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">OJR</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span></div><div id="site-info"><div id="site-title">OJR</div><div id="site-sub-title"></div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item"><a class="article-title" href="/2018/05/13/zookeeper/">ZooKeeper</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-05-13</time><div class="content"><h1 id="Inside-ZooKeeper"><a href="#Inside-ZooKeeper" class="headerlink" title="Inside ZooKeeper"></a>Inside ZooKeeper</h1><p>architecture</p>
<p>internal procedure</p>
<h1 id="Best-practice"><a href="#Best-practice" class="headerlink" title="Best practice"></a>Best practice</h1><ul>
<li>每个znode的最佳大小</li>
<li>并发读写性能是多少</li>
</ul>
<h1 id="Operation"><a href="#Operation" class="headerlink" title="Operation"></a>Operation</h1><p>quota分析和管理 <a href="http://zookeeper.apache.org/doc/current/zookeeperQuotas.html" target="_blank" rel="noopener">http://zookeeper.apache.org/doc/current/zookeeperQuotas.html</a><br><a href="http://zookeeper.apache.org/doc/current/zookeeperHierarchicalQuorums.html" target="_blank" rel="noopener">http://zookeeper.apache.org/doc/current/zookeeperHierarchicalQuorums.html</a><br><a href="http://zookeeper.apache.org/doc/current/index.html" target="_blank" rel="noopener">http://zookeeper.apache.org/doc/current/index.html</a></p>
</div><hr></div><div class="recent-post-item"><a class="article-title" href="/2018/05/13/tcp/">tcp</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-05-13</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/jekyll-update/">jekyll update</a></span><div class="content"><h1 id="Tcp-keep-alive"><a href="#Tcp-keep-alive" class="headerlink" title="Tcp keep alive"></a>Tcp keep alive</h1><p>There are three configurable properties that determine how Keep-Alives work. On Linux they are1:</p>
<p><strong>tcp_keepalive_time</strong><br>    default 7200 seconds<br><strong>tcp_keepalive_probes</strong><br>    default 9<br><strong>tcp_keepalive_intvl</strong><br>    default 75 seconds</p>
<p>The process works like this:</p>
<ol>
<li>Client opens TCP connection</li>
<li>If the connection is silent for tcp_keepalive_time seconds, send a single empty ACK packet.1</li>
<li>Did the server respond with a corresponding ACK of its own?<br><strong>No</strong><br>Wait tcp_keepalive_intvl seconds, then send another ACK<br>Repeat until the number of ACK probes that have been sent equals tcp_keepalive_probes.<br>If no response has been received at this point, send a RST and terminate the connection.</li>
</ol>
<p><strong>Yes</strong>: Return to step 2</p>
<h1 id="How-to-configure-on-os-level"><a href="#How-to-configure-on-os-level" class="headerlink" title="How to configure on os level"></a>How to configure on os level</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sysctl -w net.ipv4.tcp_keepalive_time=60</span><br><span class="line">sysctl -w net.ipv4.tcp_keepalive_intvl=20</span><br></pre></td></tr></table></figure>
<h1 id="TCP-heartbeat"><a href="#TCP-heartbeat" class="headerlink" title="TCP heartbeat"></a>TCP heartbeat</h1><p><strong>environment</strong>: QLB —&gt; Nginx API Gatewy —&gt; Upstream Server</p>
<p><strong>why</strong></p>
<ul>
<li>Checking for dead peers</li>
<li>Preventing disconnection due to network inactivity</li>
<li>reclaim network resource if connection is idle</li>
</ul>
<p>You will not get far with the built-in keep-alives of the TCP stack. That’s because the keep-alive interval cannot be tuned by your application, it is set by the OS, and the defaults are rather high (hours). This is not specific to Java.</p>
</div><hr></div><div class="recent-post-item"><a class="article-title" href="/2018/05/13/system/">system</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-05-13</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/jekyll-update/">jekyll update</a></span><div class="content"><p>systemd units? system, scope, slice<br>Available systemd Unit Types?</p>
<h1 id="Command"><a href="#Command" class="headerlink" title="Command"></a>Command</h1><p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/resource_management_guide/sec-Obtaining_Information_About_Control_Groups" target="_blank" rel="noopener">systemd-cgls</a></p>
<p>systemctl list-units</p>
<p>systemd-cgtop</p>
<p>systemd-cgls [subsys name]</p>
<p>systemctl daemon-reload // reload the systemd configuration</p>
<p>systemctl:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">System Commands:</span><br><span class="line">  is-system-running               Check whether system is fully running</span><br><span class="line">  default                         Enter system default mode</span><br><span class="line">  rescue                          Enter system rescue mode</span><br><span class="line">  emergency                       Enter system emergency mode</span><br><span class="line">  halt                            Shut down and halt the system</span><br><span class="line">  poweroff                        Shut down and power-off the system</span><br><span class="line">  reboot [ARG]                    Shut down and reboot the system</span><br><span class="line">  kexec                           Shut down and reboot the system with kexec</span><br><span class="line">  exit                            Request user instance exit</span><br><span class="line">  switch-root ROOT [INIT]         Change to a different root file system</span><br><span class="line">  suspend                         Suspend the system</span><br><span class="line">  hibernate                       Hibernate the system</span><br><span class="line">  hybrid-sleep                    Hibernate and suspend the system</span><br></pre></td></tr></table></figure></p>
<p>display the status of service managed by systemd<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl list-units --type service --all</span><br></pre></td></tr></table></figure></p>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/resource_management_guide/chap-using_control_groups#sec-Creating_Cgroups" target="_blank" rel="noopener">run a command in specified cgroup</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemd-run --unit=name --scope --slice=slice_name command</span><br></pre></td></tr></table></figure></p>
<h1 id="systemd-amp-cgroup"><a href="#systemd-amp-cgroup" class="headerlink" title="systemd &amp; cgroup"></a>systemd &amp; cgroup</h1><h1 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h1><p><strong>about JoinControllers</strong>: modify it in /etc/systemd/system.conf won’t take effect if your os apply initrd<br><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/6/html/deployment_guide/sec-verifying_the_initial_ram_disk_image" target="_blank" rel="noopener">solution</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dracut --force</span><br></pre></td></tr></table></figure></p>
<h1 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h1><ol>
<li><p>how to start process at system startup by systemd<br><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/system_administrators_guide/sect-Managing_Services_with_systemd-Services#tabl-Managing_Services_with_systemd-Services-systemctl" target="_blank" rel="noopener">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/system_administrators_guide/sect-Managing_Services_with_systemd-Services#tabl-Managing_Services_with_systemd-Services-systemctl</a><br><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/system_administrators_guide/sect-Managing_Services_with_systemd-Services#tabl-Managing_Services_with_systemd-Services-chkconfig" target="_blank" rel="noopener">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/system_administrators_guide/sect-Managing_Services_with_systemd-Services#tabl-Managing_Services_with_systemd-Services-chkconfig</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable name.service</span><br><span class="line">systemctl disable name.service</span><br><span class="line"></span><br><span class="line">systemctl list-unit-files --type service</span><br><span class="line">systemctl list-dependencies --after</span><br><span class="line">systemctl list-dependencies --before</span><br></pre></td></tr></table></figure>
</li>
<li><p>what is target?</p>
</li>
</ol>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><blockquote>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/resource_management_guide/sec-default_cgroup_hierarchies" target="_blank" rel="noopener">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/resource_management_guide/sec-default_cgroup_hierarchies</a></p>
</blockquote>
<blockquote>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/system_administrators_guide/chap-Managing_Services_with_systemd#tabl-Managing_Services_with_systemd-Introduction-Units-Locations" target="_blank" rel="noopener">Systemd Unit Files Locations</a></p>
</blockquote>
</div><hr></div><div class="recent-post-item"><a class="article-title" href="/2018/05/13/python-note/">python experience</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-05-13</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/jekyll-update/">jekyll update</a></span><div class="content"><h1 id="When-to-use-package-level-member"><a href="#When-to-use-package-level-member" class="headerlink" title="When to use package level member?"></a>When to use package level member?</h1><pre><code>- most of the module is package public, the minority module is visible to other package
</code></pre></div><hr></div><div class="recent-post-item"><a class="article-title" href="/2018/05/13/mongoengine_source_inside/">No title</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-05-13</time><div class="content"><hr>
<p>title:  “Mongoengine Source Inside”<br>categories: jekyll update</p>
<hr>
</div><hr></div><div class="recent-post-item"><a class="article-title" href="/2018/05/13/hello-world/">Hello World</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-05-13</time><div class="content"><p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>
</div><hr></div><div class="recent-post-item"><a class="article-title" href="/2018/05/13/component-interactive/">Conponent Interaction in Coding</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-05-13</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/jekyll-update/">jekyll update</a></span><div class="content"></div><hr></div><div class="recent-post-item"><a class="article-title" href="/2018/05/13/cgroups_and_namespace/">Cgroups and Namespace</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-05-13</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/jekyll-update/">jekyll update</a></span><div class="content"><h1 id="Cgroups"><a href="#Cgroups" class="headerlink" title="Cgroups"></a>Cgroups</h1><p>To put it simple, cgroups are a metering and limiting mechanism, they control<br>how much of a system resource (CPU, memory) you can use. On the other hand,<br>namespaces limit what you can see. Thanks to namespaces processes have their<br>own view of the system’s resources.</p>
<h2 id="Subsystem"><a href="#Subsystem" class="headerlink" title="Subsystem"></a>Subsystem</h2><p><em>hierarchy</em>: combination of subsystem. subsystem can only be part of single hierarchy</p>
<p><em>control group</em>: subdirectory of the hierarchy, it further limit the resource of its task other than the configuration of its parent group</p>
<h2 id="How-to-use-cgroup"><a href="#How-to-use-cgroup" class="headerlink" title="How to use cgroup?"></a>How to use cgroup?</h2><p><em>Command</em></p>
<ul>
<li><p>cgexec</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cgexec -g blkio:test1 dd if=file-abc of=/dev/null</span><br></pre></td></tr></table></figure>
</li>
<li><p>cgdelete subsystems:path</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">where:</span><br><span class="line">    subsystems is a comma‑separated list of subsystems.</span><br><span class="line">    path is the path to the cgroup relative to the root of the hierarchy.</span><br><span class="line"></span><br><span class="line">As i know, this command will echo msg like &apos;cgdelete: cannot remove group &apos;hubble-agent&apos;: No such file or directory&apos;, but it succeeds most of the time</span><br></pre></td></tr></table></figure>
</li>
<li><p>create a control group</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cgcreate -t uid:gid -a uid:gid -g controllers:path</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>controllers is not necessary to the subsystem combination</p>
<ul>
<li>lssubsys</li>
</ul>
<p>lscgroup</p>
<p>configuration</p>
<p>subsystem</p>
<h3 id="other"><a href="#other" class="headerlink" title="other"></a>other</h3><ol>
<li>/proc/<pid>/cgroup provides with list of hierarchy and corresponding control group that this process belongs to</pid></li>
</ol>
<h1 id="Namespace"><a href="#Namespace" class="headerlink" title="Namespace"></a>Namespace</h1><p>Network namespaces</p>
<hr>
<h1 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h1><p><strong>Tools</strong></p>
<ul>
<li>nsenter</li>
</ul>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><blockquote>
<p><a href="https://blogs.igalia.com/dpino/2016/04/10/network-namespaces/" target="_blank" rel="noopener">https://blogs.igalia.com/dpino/2016/04/10/network-namespaces/</a></p>
</blockquote>
<blockquote>
<p><a href="http://cizixs.com/2017/02/10/network-virtualization-network-namespace" target="_blank" rel="noopener">Network Namespace</a></p>
</blockquote>
<hr>
<h1 id="temporary-note-from-youdao"><a href="#temporary-note-from-youdao" class="headerlink" title="temporary note from youdao"></a>temporary note from youdao</h1><h2 id="terminlogy-in-cgroup"><a href="#terminlogy-in-cgroup" class="headerlink" title="terminlogy in cgroup:"></a>terminlogy in cgroup:</h2><pre><code>1. https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/6/html/resource_management_guide/sec-relationships_between_subsystems_hierarchies_control_groups_and_tasks
2. usage and tools
https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/resource_management_guide/sec-default_cgroup_hierarchies
</code></pre><h3 id="hierarchy"><a href="#hierarchy" class="headerlink" title="hierarchy"></a>hierarchy</h3><h3 id="group"><a href="#group" class="headerlink" title="group"></a>group</h3><h3 id="subsystem"><a href="#subsystem" class="headerlink" title="subsystem"></a>subsystem</h3><h3 id="controllers"><a href="#controllers" class="headerlink" title="controllers"></a>controllers</h3><pre><code>Never use libcgropup tools to modify the default hierarchies mounted by systemd since it would lead to unexpected behavior. The libcgroup library will be removed in future versions of Red Hat Enterprise Linux. 
</code></pre><p>systemd  <a href="https://linuxaria.com/article/how-to-manage-processes-with-cgroup-on-systemd" target="_blank" rel="noopener">https://linuxaria.com/article/how-to-manage-processes-with-cgroup-on-systemd</a><br>    So Control Groups are two things: (A) a way to hierarchally group and label processes, and (B) a way to then apply resource limits to these groups. systemd only requires the former (A), and not the latter (B).</p>
<pre><code>systemctl kill auditd.service
# systemctl kill -s SIGKILL auditd.service


 systemd-cgtop  for resource usage monitoring, 可以看看这个方法能否快速实现进程网络io的统计
 systemd-cgls
</code></pre><p>systemd + cgroup, i think it’s a good combination</p>
<p>cgroup:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Multiple separate hierarchies of cgroups are necessary because each hierarchy is attached to one or more subsystems.</span><br></pre></td></tr></table></figure></p>
<p>cmd to mount cgroup:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -t cgroup -o cpuset,memory hier1 /sys/fs/cgroup/rg1</span><br></pre></td></tr></table></figure></p>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/6/html/resource_management_guide/sec-relationships_between_subsystems_hierarchies_control_groups_and_tasks" target="_blank" rel="noopener">cgroup tutorial</a></p>
<h1 id="Terminlonogy"><a href="#Terminlonogy" class="headerlink" title="Terminlonogy"></a>Terminlonogy</h1><p>subsystem, cgroup, hierarchy and task ?</p>
<p>这个文章一定程度上暗示了什么是hierarchy: <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/6/html/resource_management_guide/ch-using_control_groups" target="_blank" rel="noopener">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/6/html/resource_management_guide/ch-using_control_groups</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Note that multiple subsystems can be mounted to a single hierarchy, but each subsystem can be mounted only once.</span><br></pre></td></tr></table></figure></p>
<p><strong>Command</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">列出subsystem是否挂载，挂到哪个hierarchy上？</span><br><span class="line"># lssubsys -am</span><br><span class="line"></span><br><span class="line">Creating a mount entry，通过配置文件和命令的挂载方法？</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">重新调整hierarchy所挂载的subsystem: 使用 -o remount,[subsystem combination]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">stat: /proc/cgroups</span><br><span class="line"></span><br><span class="line">how to show all the hierarchy directory?  lssubsys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">怎样列出 sussystems 下的所有hierarchy目录？ lssubsys -am只能显示一个，是不是说多个目录最终都映射到同一个中？ 我测试了一下，应该使用类似软连接的技术，我同时将同一个subsystem combination挂载到多个hierarchy下，重新remount其中一个，都会影响所有hierarchy。 同时，这意味着将所有相关的hierarchy umount后才能将subsystem combination释放掉，即unmount其中一个不会影响其他。 向其中一个hierarchy加入group，会影响其他的hierarchy目录。 测试了那么多，归根到底，只要在hierarchy下创建了group，直到你cgdelete这个group为止，这个hierarchy都会存在，即是是umount hierarchy</span><br><span class="line"></span><br><span class="line">cgdelete并不会杀死group里面的task进程</span><br><span class="line"></span><br><span class="line">lssubsys  列出所有的hierarchy，默认情况下hierarchy名为subsystem名</span><br><span class="line">lssubsys -a 列出所有的subsystem</span><br><span class="line">lssubsys -am</span><br></pre></td></tr></table></figure></p>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/6/html/resource_management_guide/sec-relationships_between_subsystems_hierarchies_control_groups_and_tasks" target="_blank" rel="noopener">Rule</a></p>
<ol>
<li>subsystem特定的组合后，不能再切割或变成一个子组合。  这应该是rule 2</li>
</ol>
<h1 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h1><ol>
<li>研究systemd and cgroup，他们怎样组合一起使用？</li>
<li>umount <hierarchy>的副作用以及怎样解决？</hierarchy></li>
<li>/proc/mounts  headers解析，比如第一列是device name</li>
<li>当group还有task正在运行时， mount 和 mount -o remount[,xxx] 会报 <strong>mount: <hierarchy dir=""> is busy</hierarchy></strong>。 就算你umount了，由于group信息仍然残留在kernel中，<strong>lssubsys</strong> 和 <strong>lssubsys -a</strong>依然会显示这个subsystem combination，但是 <strong>lssubsys -am</strong>不会显示，因为没有mount point</li>
<li>if umounting hierarchy while there are still some running group, the hierarchy info skill exists in the kernel. You can not mount any subsystem within that hierarchy until you delete those group</li>
<li>[investigate systemd, its unit system and combination with cgroup] (<a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/resource_management_guide/sec-modifying_control_groups" target="_blank" rel="noopener">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/resource_management_guide/sec-modifying_control_groups</a>)</li>
</ol>
<p><a href="https://en.wikipedia.org/wiki/Systemd" target="_blank" rel="noopener">这个layer char不错</a></p>
<p>apply systemd config change:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># systemctl daemon-reload</span><br><span class="line"># systemctl restart example.service</span><br></pre></td></tr></table></figure></p>
<ol start="7">
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-limit-resources-using-cgroups-on-centos-6" target="_blank" rel="noopener">how to let cgroup mount all the subsystem on start up for centos 6.x</a></li>
</ol>
</div><hr></div><div class="recent-post-item"><a class="article-title" href="/2018/05/13/big data/">Big Data</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-05-13</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/big-data/">big data</a></span><div class="content"><h1 id="一致性"><a href="#一致性" class="headerlink" title="一致性"></a>一致性</h1><p>2pc<br>3pc</p>
<h1 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h1><h3 id="服务器如何应对故障，如何容错"><a href="#服务器如何应对故障，如何容错" class="headerlink" title="服务器如何应对故障，如何容错"></a>服务器如何应对故障，如何容错</h3><ul>
<li>zk, chubby</li>
<li>hdfs</li>
<li>hbase</li>
<li>redis</li>
</ul>
<h3 id="为什么要journal-node而不是ZK，是不是数据量太大？"><a href="#为什么要journal-node而不是ZK，是不是数据量太大？" class="headerlink" title="为什么要journal node而不是ZK，是不是数据量太大？"></a>为什么要journal node而不是ZK，是不是数据量太大？</h3><h3 id="Hadoop怎样基于ZK做主备切换的？要详细讲解一下方案，-比如主备之间怎样同步信息"><a href="#Hadoop怎样基于ZK做主备切换的？要详细讲解一下方案，-比如主备之间怎样同步信息" class="headerlink" title="Hadoop怎样基于ZK做主备切换的？要详细讲解一下方案， 比如主备之间怎样同步信息"></a>Hadoop怎样基于ZK做主备切换的？要详细讲解一下方案， 比如主备之间怎样同步信息</h3><h3 id="怎样的方式能更好地介绍系统，方便理解运行流程、请求处理路径、瓶颈、运维问题"><a href="#怎样的方式能更好地介绍系统，方便理解运行流程、请求处理路径、瓶颈、运维问题" class="headerlink" title="怎样的方式能更好地介绍系统，方便理解运行流程、请求处理路径、瓶颈、运维问题"></a>怎样的方式能更好地介绍系统，方便理解运行流程、请求处理路径、瓶颈、运维问题</h3><ul>
<li>各类、线程在时间的顺序上的关系？</li>
<li>各类各线程的职责以及相关的数据？</li>
<li>瓶颈： 哪些共同的锁？</li>
<li>每个处理路径上的相关指标？</li>
</ul>
<h3 id="锁的类型以及怎样处理竞争条件"><a href="#锁的类型以及怎样处理竞争条件" class="headerlink" title="锁的类型以及怎样处理竞争条件"></a>锁的类型以及怎样处理竞争条件</h3><ul>
<li>轻量级、重量级锁，乐观锁，自旋锁, 排他锁，读写锁</li>
<li>thread local</li>
<li>多副本来解决并发问题，这里好像有一个相关的协议的</li>
</ul>
</div><hr></div><div class="recent-post-item"><a class="article-title" href="/2018/05/13/G1/">JVM G1 Investigation</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-05-13</time><div class="content"></div><hr></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2015 - 2018 By OJR</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="/js/third-party/anime.min.js"></script><script src="/js/third-party/jquery.min.js"></script><script src="/js/third-party/jquery.fancybox.min.js"></script><script src="/js/third-party/velocity.min.js"></script><script src="/js/third-party/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.5.4"></script><script src="/js/fancybox.js?version=1.5.4"></script><script src="/js/sidebar.js?version=1.5.4"></script><script src="/js/copy.js?version=1.5.4"></script><script src="/js/fireworks.js?version=1.5.4"></script><script src="/js/transition.js?version=1.5.4"></script><script src="/js/scroll.js?version=1.5.4"></script><script src="/js/head.js?version=1.5.4"></script></body></html>