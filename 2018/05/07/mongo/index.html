<!DOCTYPE html><html><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Quick Overlook of Mongodb"><meta name="keywords" content="mongodb"><meta name="author" content="YYY,undefined"><meta name="copyright" content="YYY"><title>Quick Overlook of Mongodb | XXX</title><link rel="shortcut icon" href="/blog/favicon.ico"><link rel="stylesheet" href="/blog/css/index.css"><link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css?version=1.5.4"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><script>var GLOBAL_CONFIG = { 
  root: '/blog/',
  algolia: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  localSearch: undefined
} </script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Table-of-Content"><span class="toc-number">1.</span> <span class="toc-text">Table of Content</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Data-Model"><span class="toc-number">2.</span> <span class="toc-text">Data Model</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Document-Relationship-Between-Documents"><span class="toc-number">2.1.</span> <span class="toc-text">Document Relationship Between Documents</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#One-to-One-Relationships"><span class="toc-number">2.1.1.</span> <span class="toc-text">One-to-One Relationships</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#One-to-Many-Relationships"><span class="toc-number">2.1.2.</span> <span class="toc-text">One-to-Many Relationships</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Model-specific-application-context"><span class="toc-number">2.2.</span> <span class="toc-text">Model specific application context</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Model-Data-to-Support-Keyword-Search-by-adding-key-word-to-an-array"><span class="toc-number">2.2.1.</span> <span class="toc-text">Model Data to Support Keyword Search by adding key word to an array:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Model-Data-for-Atomic-Operations"><span class="toc-number">2.2.2.</span> <span class="toc-text">Model Data for Atomic Operations</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Performance"><span class="toc-number">3.</span> <span class="toc-text">Performance</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Index"><span class="toc-number">3.1.</span> <span class="toc-text">Index</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Create-index"><span class="toc-number">3.1.1.</span> <span class="toc-text">Create index</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Index-Types"><span class="toc-number">3.1.2.</span> <span class="toc-text">Index Types</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Single-Field"><span class="toc-number">3.1.2.1.</span> <span class="toc-text">Single Field</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Compound-Index"><span class="toc-number">3.1.2.2.</span> <span class="toc-text">Compound Index</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Multikey-index"><span class="toc-number">3.1.2.3.</span> <span class="toc-text">Multikey index</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Geospatial-Index"><span class="toc-number">3.1.2.4.</span> <span class="toc-text">Geospatial Index</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Text-Indexes"><span class="toc-number">3.1.2.5.</span> <span class="toc-text">Text Indexes</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Hashed-Indexes"><span class="toc-number">3.1.2.6.</span> <span class="toc-text">Hashed Indexes</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Index-Properties"><span class="toc-number">3.1.3.</span> <span class="toc-text">Index Properties</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Shard"><span class="toc-number">3.2.</span> <span class="toc-text">Shard</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#mongodb-operation-amp-limitation"><span class="toc-number">3.2.1.</span> <span class="toc-text">mongodb operation &amp; limitation</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Atomic-operation"><span class="toc-number">3.3.</span> <span class="toc-text">Atomic operation</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Example"><span class="toc-number">4.</span> <span class="toc-text">Example</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Reference"><span class="toc-number">5.</span> <span class="toc-text">Reference</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Temporary-note"><span class="toc-number">6.</span> <span class="toc-text">Temporary note</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#categories"><span class="toc-number">6.1.</span> <span class="toc-text">categories: []</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Document-Relationship"><span class="toc-number">7.</span> <span class="toc-text">Document Relationship</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#One-to-One"><span class="toc-number">7.1.</span> <span class="toc-text">One to One</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Model-Tree-Structures"><span class="toc-number">7.2.</span> <span class="toc-text">Model Tree Structures</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#join-amp-avoid-join"><span class="toc-number">7.3.</span> <span class="toc-text">join &amp; avoid join</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Overview-Limit"><span class="toc-number">8.</span> <span class="toc-text">Overview/Limit</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Data-model-and-pattern"><span class="toc-number">9.</span> <span class="toc-text">Data model and pattern</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Operational-Factors-and-Data-Models"><span class="toc-number">9.0.1.</span> <span class="toc-text">Operational Factors and Data Models</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Design-model-pattern"><span class="toc-number">10.</span> <span class="toc-text">Design model, pattern</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Index-1"><span class="toc-number">11.</span> <span class="toc-text">Index</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Shard-1"><span class="toc-number">12.</span> <span class="toc-text">Shard</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Atomic-operation-1"><span class="toc-number">13.</span> <span class="toc-text">Atomic operation</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Performance-1"><span class="toc-number">14.</span> <span class="toc-text">Performance</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Example-1"><span class="toc-number">15.</span> <span class="toc-text">Example</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/blog/img/avatar.png"></div><div class="author-info__name text-center">YYY</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/blog/archives"><span class="pull-left">Articles</span><span class="pull-right">13</span></a><a class="author-info-articles__tags article-meta" href="/blog/tags"><span class="pull-left">Tags</span><span class="pull-right">1</span></a><a class="author-info-articles__categories article-meta" href="/blog/categories"><span class="pull-left">Categories</span><span class="pull-right">6</span></a></div></div></div><div id="content-outer"><div class="plain" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/blog/">XXX</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span></div></div><div class="layout" id="content-inner"><article id="post"><div class="plain" id="post-title">Quick Overlook of Mongodb</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-05-07</time><span class="post-meta__separator">|</span><i class="fa fa-inbox" aria-hidden="true"></i><a class="post-meta__categories" href="/blog/categories/ojr/"> ojr</a><i class="fa fa-angle-right post-meta__separator" aria-hidden="true"></i><i class="fa fa-inbox" aria-hidden="true"></i><a class="post-meta__categories" href="/blog/categories/ojr/test/"> test</a><i class="fa fa-angle-right post-meta__separator" aria-hidden="true"></i><i class="fa fa-inbox" aria-hidden="true"></i><a class="post-meta__categories" href="/blog/categories/ojr/test/category/"> category</a></div><div id="post-content"><h1 id="Table-of-Content"><a href="#Table-of-Content" class="headerlink" title="Table of Content"></a>Table of Content</h1><ul>
<li>Overview</li>
<li>Data model and pattern</li>
<li>Performance</li>
<li>Example/Frequently used function</li>
</ul>
<hr>
<h1 id="Data-Model"><a href="#Data-Model" class="headerlink" title="Data Model"></a>Data Model</h1><h2 id="Document-Relationship-Between-Documents"><a href="#Document-Relationship-Between-Documents" class="headerlink" title="Document Relationship Between Documents"></a>Document Relationship Between Documents</h2><p>Document relationship includes:</p>
<ul>
<li><strong>one-to-one</strong></li>
<li><strong>one-to-many</strong></li>
</ul>
<p>Relationship are maintained with:</p>
<ul>
<li><strong>document references</strong></li>
<li><strong>embedded documents</strong></li>
</ul>
<table>
<thead>
<tr>
<th>&lt;/&gt;</th>
<th>Advantage</th>
<th>Disadvantage</th>
</tr>
</thead>
<tbody>
<tr>
<td>embedded documents</td>
<td>benefit from data localization</td>
<td>introduction large document problem and trigger space relocation if document is too large especially using an embedded array <a href="https://docs.mongodb.com/manual/core/data-model-operations/#data-model-document-growth" target="_blank" rel="noopener">MMAPv1</a></td>
</tr>
<tr>
<td>document references</td>
<td>a. avoid document repetition<br> b. reduce single document size</td>
<td>need to issue multiple query to refer to other docuement</td>
</tr>
</tbody>
</table>
<h3 id="One-to-One-Relationships"><a href="#One-to-One-Relationships" class="headerlink" title="One-to-One Relationships"></a>One-to-One Relationships</h3><figure class="highlight"><figcaption><span>With Referencing</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// patron document</span><br><span class="line">&#123;</span><br><span class="line">   _id: "joe",</span><br><span class="line">   name: "Joe Bookreader"</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// address document</span><br><span class="line">&#123;</span><br><span class="line">   patron_id: "joe",</span><br><span class="line">   street: "123 Fake Street",</span><br><span class="line">   city: "Faketon",</span><br><span class="line">   state: "MA",</span><br><span class="line">   zip: "12345"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Apply embedded document If the address data is frequently retrieved with the name information,<br>which is known as data localization:</p>
<figure class="highlight"><figcaption><span>With Embedded Document</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  _id: "joe",</span><br><span class="line">  name: "Joe Bookreader",</span><br><span class="line">  address: &#123;</span><br><span class="line">    street: "123 Fake Street",</span><br><span class="line">    city: "Faketon",</span><br><span class="line">    state: "MA",</span><br><span class="line">    zip: "12345"</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="One-to-Many-Relationships"><a href="#One-to-Many-Relationships" class="headerlink" title="One-to-Many Relationships"></a>One-to-Many Relationships</h3><p>Use <strong>embedded document</strong> when the <strong>patron</strong> has multiple <strong>address</strong> entities:</p>
<figure class="highlight"><figcaption><span>With Embedded Document</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  _id: "joe",</span><br><span class="line">  name: "Joe Bookreader",</span><br><span class="line">  addresses: [</span><br><span class="line">    &#123;</span><br><span class="line">      street: "123 Fake Street",</span><br><span class="line">      city: "Faketon",</span><br><span class="line">      state: "MA",</span><br><span class="line">      zip: "12345"</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      street: "1 Some Other Street",</span><br><span class="line">      city: "Boston",</span><br><span class="line">      state: "MA",</span><br><span class="line">      zip: "12345"</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Referencing</strong> over embedding to <strong>avoid repetition</strong> in this example that maps<br>publisher and book relationships. Storing the books reference <strong>inside an array</strong><br>of publisher <strong>if number of books per publisher is small with limited growth</strong>: </p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">// Publisher document</span><br><span class="line">&#123;</span><br><span class="line">  name: "O'Reilly Media",</span><br><span class="line">  founded: 1980,</span><br><span class="line">  location: "CA",</span><br><span class="line">  books: [123456789, 234567890, ...]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Book document</span><br><span class="line">&#123;</span><br><span class="line">    _id: 123456789,</span><br><span class="line">    title: "MongoDB: The Definitive Guide",</span><br><span class="line">    author: [ "Kristina Chodorow", "Mike Dirolf" ],</span><br><span class="line">    published_date: ISODate("2010-09-24"),</span><br><span class="line">    pages: 216,</span><br><span class="line">    language: "English"</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Book document</span><br><span class="line">&#123;</span><br><span class="line">   _id: 234567890,</span><br><span class="line">   title: "50 Tips and Tricks for MongoDB Developer",</span><br><span class="line">   author: "Kristina Chodorow",</span><br><span class="line">   published_date: ISODate("2011-05-06"),</span><br><span class="line">   pages: 68,</span><br><span class="line">   language: "English"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>To <strong>avoid mutable, growing arrays</strong>, store the publisher reference inside the book document:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">// Publisher document</span><br><span class="line">&#123;</span><br><span class="line">   _id: "oreilly",</span><br><span class="line">   name: "O'Reilly Media",</span><br><span class="line">   founded: 1980,</span><br><span class="line">   location: "CA"</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Book document</span><br><span class="line">&#123;</span><br><span class="line">   _id: 123456789,</span><br><span class="line">   title: "MongoDB: The Definitive Guide",</span><br><span class="line">   author: [ "Kristina Chodorow", "Mike Dirolf" ],</span><br><span class="line">   published_date: ISODate("2010-09-24"),</span><br><span class="line">   pages: 216,</span><br><span class="line">   language: "English",</span><br><span class="line">   publisher_id: "oreilly"</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Book document</span><br><span class="line">&#123;</span><br><span class="line">   _id: 234567890,</span><br><span class="line">   title: "50 Tips and Tricks for MongoDB Developer",</span><br><span class="line">   author: "Kristina Chodorow",</span><br><span class="line">   published_date: ISODate("2011-05-06"),</span><br><span class="line">   pages: 68,</span><br><span class="line">   language: "English",</span><br><span class="line">   publisher_id: "oreilly"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Model-specific-application-context"><a href="#Model-specific-application-context" class="headerlink" title="Model specific application context"></a>Model specific application context</h2><ul>
<li>Model Data to Support Keyword Search by adding key word to an array:</li>
<li>Model Data for Atomic Operations</li>
</ul>
<h3 id="Model-Data-to-Support-Keyword-Search-by-adding-key-word-to-an-array"><a href="#Model-Data-to-Support-Keyword-Search-by-adding-key-word-to-an-array" class="headerlink" title="Model Data to Support Keyword Search by adding key word to an array:"></a>Model Data to Support Keyword Search by adding key word to an array:</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123; title : "Moby-Dick" ,</span><br><span class="line">  author : "Herman Melville" ,</span><br><span class="line">  published : 1851 ,</span><br><span class="line">  ISBN : 0451526996 ,</span><br><span class="line">  topics : [ "whaling" , "allegory" , "revenge" , "American" ,</span><br><span class="line">    "novel" , "nautical" , "voyage" , "Cape Cod"</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Create an index on the topics array:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.volumes.createIndex( &#123; <span class="attr">topics</span>: <span class="number">1</span> &#125; )</span><br></pre></td></tr></table></figure>
<p>Query based on the key word:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.volumes.findOne( &#123; <span class="attr">topics</span> : <span class="string">"voyage"</span> &#125;, &#123; <span class="attr">title</span>: <span class="number">1</span> &#125; )</span><br></pre></td></tr></table></figure>
<h3 id="Model-Data-for-Atomic-Operations"><a href="#Model-Data-for-Atomic-Operations" class="headerlink" title="Model Data for Atomic Operations"></a>Model Data for Atomic Operations</h3><p>Operation within a document is atomic. For fields that must be updated together, embedding the fields within the same document ensures that the fields can be updated atomically.</p>
<p>The available copies of the book and the checkout information should be in sync:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  _id: 123456789,</span><br><span class="line">  title: "MongoDB: The Definitive Guide",</span><br><span class="line">  author: [ "Kristina Chodorow", "Mike Dirolf" ],</span><br><span class="line">  published_date: ISODate("2010-09-24"),</span><br><span class="line">  pages: 216,</span><br><span class="line">  language: "English",</span><br><span class="line">  publisher_id: "oreilly",</span><br><span class="line">  available: 3,</span><br><span class="line">  checkout: [ &#123; by: "joe", date: ISODate("2012-10-15") &#125; ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Update with new checkout information:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">db.books.update (</span><br><span class="line">   &#123; <span class="attr">_id</span>: <span class="number">123456789</span>, <span class="attr">available</span>: &#123; <span class="attr">$gt</span>: <span class="number">0</span> &#125; &#125;,</span><br><span class="line">   &#123;</span><br><span class="line">     $inc: &#123; <span class="attr">available</span>: <span class="number">-1</span> &#125;,</span><br><span class="line">     $push: &#123; <span class="attr">checkout</span>: &#123; <span class="attr">by</span>: <span class="string">"abc"</span>, <span class="attr">date</span>: <span class="keyword">new</span> <span class="built_in">Date</span>() &#125; &#125;</span><br><span class="line">   &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="Performance"><a href="#Performance" class="headerlink" title="Performance"></a>Performance</h1><ul>
<li>query over reference, across collections?</li>
<li>index</li>
<li>shard</li>
</ul>
<h2 id="Index"><a href="#Index" class="headerlink" title="Index"></a>Index</h2><p>[TODO] b+,b-,lsm comparison</p>
<p>[TODO] penalty while creating index for large number of small index</p>
<p>Indexes can <strong>improve query efficiency</strong> in MongoDB. Without indexes, MongoDB must <strong>scan the whole collection</strong> to select those documents that match the query statement. </p>
<p>Index in MongoDB use a <strong>B-tree</strong> data structure.</p>
<p>By default, MongoDB creates a <strong>unique index</strong> on the _id field.</p>
<h3 id="Create-index"><a href="#Create-index" class="headerlink" title="Create index"></a>Create index</h3><figure class="highlight javascript"><figcaption><span>Mongo Shell</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.createIndex( &lt;key and index type specification&gt;, &lt;options&gt; )</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><figcaption><span>Create a descending index on name field</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.createIndex( &#123; <span class="attr">name</span>: <span class="number">-1</span> &#125; )</span><br></pre></td></tr></table></figure>
<h3 id="Index-Types"><a href="#Index-Types" class="headerlink" title="Index Types"></a>Index Types</h3><h4 id="Single-Field"><a href="#Single-Field" class="headerlink" title="Single Field"></a>Single Field</h4><p><img src="https://docs.mongodb.com/manual/_images/index-ascending.bakedsvg.svg" alt="image"></p>
<figure class="highlight"><figcaption><span>Record</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"_id"</span>: ObjectId(<span class="string">"570c04a4ad233577f97dc459"</span>),</span><br><span class="line">  <span class="attr">"score"</span>: <span class="number">1034</span>,</span><br><span class="line">  "location": &#123; state: "NY", city: "New York" &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><figcaption><span>creates an ascending index on the score field</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.createIndex( &#123; <span class="attr">name</span>: <span class="number">-1</span> &#125; )</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><figcaption><span>Create an Index on an Embedded Field</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.records.createIndex( &#123; <span class="string">"location.state"</span>: <span class="number">1</span> &#125; )</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><figcaption><span>Create an Index on Embedded Document</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.records.createIndex( &#123; <span class="attr">location</span>: <span class="number">1</span> &#125; )</span><br></pre></td></tr></table></figure>
<h4 id="Compound-Index"><a href="#Compound-Index" class="headerlink" title="Compound Index"></a>Compound Index</h4><p>MongoDB supports index on multiple field. For example, { userid: 1, score: -1 }, the index sorts first by userid and then, within each userid value, sorts by score.</p>
<h4 id="Multikey-index"><a href="#Multikey-index" class="headerlink" title="Multikey index"></a>Multikey index</h4><p> If you index a field that holds an <strong>array value</strong>, MongoDB creates separate index entries for every element of the array.</p>
<p><img src="https://docs.mongodb.com/manual/_images/index-multikey.bakedsvg.svg" alt="image"></p>
<h4 id="Geospatial-Index"><a href="#Geospatial-Index" class="headerlink" title="Geospatial Index"></a>Geospatial Index</h4><p><a href="https://docs.mongodb.com/manual/core/geospatial-indexes/" target="_blank" rel="noopener">2d Index Internals</a></p>
<h4 id="Text-Indexes"><a href="#Text-Indexes" class="headerlink" title="Text Indexes"></a>Text Indexes</h4><p>MongoDB provides a text index type that supports searching for string content such as language, case sensitivity, etc</p>
<p><a href="https://docs.mongodb.com/manual/core/index-text/" target="_blank" rel="noopener">Text Indexes</a></p>
<h4 id="Hashed-Indexes"><a href="#Hashed-Indexes" class="headerlink" title="Hashed Indexes"></a>Hashed Indexes</h4><p>To support <a href="https://docs.mongodb.com/manual/core/hashed-sharding/#sharding-hashed-sharding" target="_blank" rel="noopener">hash based sharding</a>, MongoDB provides a <a href="https://docs.mongodb.com/manual/core/index-hashed/" target="_blank" rel="noopener">hashed index</a> type, which indexes the hash of the value of a field.</p>
<h3 id="Index-Properties"><a href="#Index-Properties" class="headerlink" title="Index Properties"></a>Index Properties</h3><p><a href="https://docs.mongodb.com/manual/core/index-unique/" target="_blank" rel="noopener">Unique Indexes</a>. A unique index ensures that the indexed fields do not store duplicate values.<br><figure class="highlight javascript"><figcaption><span>Create Index on multiple field</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">db.members.createIndex(</span><br><span class="line">  &#123;</span><br><span class="line">    groupNumber: <span class="number">1</span>,</span><br><span class="line">    lastname: <span class="number">1</span>, <span class="attr">firstname</span>: <span class="number">1</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    unique: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p><a href="https://docs.mongodb.com/manual/core/index-unique/" target="_blank" rel="noopener">Partial indexes</a>. Partial indexes only index the documents in a collection that meet a specified filter expression and it has <strong>lower storage requirements</strong> and <strong>reduced performance costs</strong> for index creation and maintenance<br><figure class="highlight javascript"><figcaption><span>Create partial index</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.restaurants.createIndex(</span><br><span class="line">   &#123; <span class="attr">cuisine</span>: <span class="number">1</span> &#125;,</span><br><span class="line">   &#123; <span class="attr">partialFilterExpression</span>: &#123; <span class="attr">rating</span>: &#123; <span class="attr">$gt</span>: <span class="number">5</span> &#125; &#125; &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p><a href="https://docs.mongodb.com/manual/core/index-sparse/" target="_blank" rel="noopener">Sparse Indexes</a>. Sparse indexes only contain entries for documents that have the indexed field, even if the index field contains a null value.<br><figure class="highlight javascript"><figcaption><span>Create Sparse Index with Unique Constraint</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.scores.createIndex( &#123; <span class="attr">score</span>: <span class="number">1</span> &#125; , &#123; <span class="attr">sparse</span>: <span class="literal">true</span>, <span class="attr">unique</span>: <span class="literal">true</span> &#125; )</span><br></pre></td></tr></table></figure></p>
<p><a href="https://docs.mongodb.com/manual/core/index-ttl/" target="_blank" rel="noopener">TTL indexes</a>. MongoDB can use to automatically remove documents from a collection after a certain amount of time. data like Event data, logs, and session information only need to persist for a finite amount of time.</p>
<p>The _id field does not support TTL indexes.</p>
<figure class="highlight javascript"><figcaption><span>Create TTL Index</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.eventlog.createIndex( &#123; <span class="string">"lastModifiedDate"</span>: <span class="number">1</span> &#125;, &#123; <span class="attr">expireAfterSeconds</span>: <span class="number">3600</span> &#125; )</span><br></pre></td></tr></table></figure>
<p><a href="https://docs.mongodb.com/manual/reference/limits/#index-limitations" target="_blank" rel="noopener">Index Limitation</a></p>
<p>[TODO] index overhead, performance penalization ?</p>
<h2 id="Shard"><a href="#Shard" class="headerlink" title="Shard"></a>Shard</h2><p><a href="https://docs.mongodb.com/manual/reference/glossary/#term-chunk" target="_blank" rel="noopener">https://docs.mongodb.com/manual/reference/glossary/#term-chunk</a></p>
<p><a href="https://docs.mongodb.com/manual/sharding/" target="_blank" rel="noopener">https://docs.mongodb.com/manual/sharding/</a></p>
<p><a href="https://docs.mongodb.com/manual/core/sharding-shard-key/" target="_blank" rel="noopener">https://docs.mongodb.com/manual/core/sharding-shard-key/</a></p>
<p>shard architecture?</p>
<p>chunks (default to 64MB) —&gt; shard </p>
<p>index and shard key</p>
<p>how to route data based on the shard key?</p>
<p>load balance and migration based on chunk</p>
<h3 id="mongodb-operation-amp-limitation"><a href="#mongodb-operation-amp-limitation" class="headerlink" title="mongodb operation &amp; limitation"></a>mongodb operation &amp; limitation</h3><blockquote>
<p><a href="https://docs.mongodb.com/manual/core/data-model-operations" target="_blank" rel="noopener">https://docs.mongodb.com/manual/core/data-model-operations</a></p>
</blockquote>
<blockquote>
<p><a href="https://docs.mongodb.com/manual/reference/limits/#Size-of-Namespace-File" target="_blank" rel="noopener">https://docs.mongodb.com/manual/reference/limits/#Size-of-Namespace-File</a></p>
</blockquote>
<p>index size<br>namespace?</p>
<p>rolling up small document:</p>
<ul>
<li>involve sequential reads and fewer random disk accesses</li>
<li>smaller index?</li>
</ul>
<p><strong>Storage Optimization for Small Documents</strong><br>Each MongoDB document contains a certain amount of overhead. This overhead is normally insignificant but becomes significant if all documents are just a few bytes, as might be the case if the documents in your collection only have one or two fields.</p>
<ul>
<li>cutomize _id field</li>
<li>shorter field name</li>
<li><a href="https://docs.mongodb.com/manual/core/data-model-operations/#faq-developers-embed-documents" target="_blank" rel="noopener">embed document</a></li>
</ul>
<p><strong>data lifecycle management</strong></p>
<ul>
<li>TTL</li>
<li>capped collection, FIFO</li>
</ul>
<h2 id="Atomic-operation"><a href="#Atomic-operation" class="headerlink" title="Atomic operation"></a>Atomic operation</h2><blockquote>
<p><a href="https://docs.mongodb.com/manual/core/data-model-operations/#data-model-atomicity" target="_blank" rel="noopener">https://docs.mongodb.com/manual/core/data-model-operations/#data-model-atomicity</a></p>
</blockquote>
<p>are atomic on the level of a single document.</p>
<p>embedding the available field and the checkout field within the same document ensures that you can update the two fields atomically.</p>
<p><a href="https://docs.mongodb.com/manual/core/data-model-operations/#data-model-atomicity" target="_blank" rel="noopener">https://docs.mongodb.com/manual/core/data-model-operations/#data-model-atomicity</a></p>
<p><a href="https://docs.mongodb.com/manual/core/capped-collections/" target="_blank" rel="noopener">https://docs.mongodb.com/manual/core/capped-collections/</a></p>
<p><a href="https://stackoverflow.com/questions/2811299/mongodb-index-ram-relationship?utm_medium=organic&amp;utm_source=google_rich_qa&amp;utm_campaign=google_rich_qa" target="_blank" rel="noopener">https://stackoverflow.com/questions/2811299/mongodb-index-ram-relationship?utm_medium=organic&amp;utm_source=google_rich_qa&amp;utm_campaign=google_rich_qa</a></p>
<p><a href="http://jasonwilder.com/blog/2012/02/08/optimizing-mongodb-indexes/" target="_blank" rel="noopener">http://jasonwilder.com/blog/2012/02/08/optimizing-mongodb-indexes/</a></p>
<p><a href="https://docs.mongodb.com/manual/tutorial/ensure-indexes-fit-ram/" target="_blank" rel="noopener">https://docs.mongodb.com/manual/tutorial/ensure-indexes-fit-ram/</a></p>
<ul>
<li>index</li>
<li>capped collections: update &amp; index &amp; avoid scan; </li>
<li>use reference to reduce space usage</li>
</ul>
<hr>
<h1 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h1><ul>
<li>Manipulation: query, aggregate</li>
<li>command line</li>
<li>mongoengine</li>
</ul>
<p><strong>find + forEach</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.clothes.find( &#123; $and : [ &#123; price: &#123; $exists: true &#125; &#125;, &#123; price: &#123; $type: &quot;string&quot; &#125; &#125; ] &#125; ).forEach( function( doc ) &#123;</span><br><span class="line">  doc.priceDec = NumberDecimal( doc.price );</span><br><span class="line">  db.clothes.save( doc );</span><br><span class="line">&#125; );</span><br></pre></td></tr></table></figure></p>
<p><strong>group + push all document to an array</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.event.aggregate([    &#123;<span class="attr">$group</span>:&#123;<span class="attr">_id</span>: <span class="string">'$event_name'</span>, <span class="attr">events</span>:&#123;<span class="attr">$push</span>: <span class="string">'$$CURRENT'</span>&#125;&#125;&#125;    ])</span><br><span class="line">or</span><br><span class="line">db.event.aggregate([    &#123;<span class="attr">$group</span>:&#123;<span class="attr">_id</span>: <span class="string">'$event_name'</span>, <span class="attr">events</span>:&#123;<span class="attr">$push</span>: <span class="string">'$$ROOT'</span>&#125;&#125;&#125;    ])</span><br></pre></td></tr></table></figure>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">        <span class="attr">"_id"</span> : <span class="string">"Node Update Avg Time"</span>,</span><br><span class="line">        <span class="attr">"events"</span> : [</span><br><span class="line">                &#123;</span><br><span class="line">                        <span class="attr">"_id"</span> : ObjectId(<span class="string">"5af011a0684220858c1f3839"</span>),</span><br><span class="line">                        <span class="attr">"tags"</span> : &#123;</span><br><span class="line"></span><br><span class="line">                        &#125;,</span><br><span class="line">                        <span class="attr">"event_name"</span> : <span class="string">"Node Update Avg Time"</span>,</span><br><span class="line">                        <span class="attr">"endpoint"</span> : <span class="string">"resourcemanager02-bdyf.qiyi.hadoop"</span>,</span><br><span class="line">                        <span class="attr">"start_at"</span> : NumberLong(<span class="string">"1525682592206"</span>),</span><br><span class="line">                        <span class="attr">"status"</span> : <span class="string">"problem"</span>,</span><br><span class="line">                        <span class="attr">"value"</span> : <span class="string">"not yet supported"</span>,</span><br><span class="line">                        <span class="attr">"message"</span> : <span class="string">"resourcemanager02-bdyf.qiyi.hadoop\\n10.19.56.154\\nService Output:80.25\\nDate/Time: Mon May 7 16:43:12 CST 2018\\nComment: \\n"</span>,</span><br><span class="line">                        <span class="attr">"badges"</span> : &#123;</span><br><span class="line">                                <span class="attr">"source"</span> : <span class="string">"nagios"</span>,</span><br><span class="line">                                <span class="attr">"cluster"</span> : <span class="string">"BD"</span></span><br><span class="line">                        &#125;,</span><br><span class="line">                        <span class="attr">"tasks"</span> : [ ]</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                        <span class="attr">"_id"</span> : ObjectId(<span class="string">"5af018a7684220858c1f3845"</span>),</span><br><span class="line">                        <span class="attr">"tags"</span> : &#123;</span><br><span class="line"></span><br><span class="line">                        &#125;,</span><br><span class="line">                        <span class="attr">"event_name"</span> : <span class="string">"Node Update Avg Time"</span>,</span><br><span class="line">                        <span class="attr">"endpoint"</span> : <span class="string">"resourcemanager02-bdyf.qiyi.hadoop"</span>,</span><br><span class="line">                        <span class="attr">"start_at"</span> : NumberLong(<span class="string">"1525684391608"</span>),</span><br><span class="line">                        <span class="attr">"status"</span> : <span class="string">"ok"</span>,</span><br><span class="line">                        <span class="attr">"value"</span> : <span class="string">"not yet supported"</span>,</span><br><span class="line">                        <span class="attr">"message"</span> : <span class="string">"resourcemanager02-bdyf.qiyi.hadoop\\n10.19.56.154\\nService Output:0.97\\nDate/Time: Mon May 7 17:13:11 CST 2018\\nComment: \\n"</span>,</span><br><span class="line">                        <span class="attr">"badges"</span> : &#123;</span><br><span class="line">                                <span class="attr">"source"</span> : <span class="string">"nagios"</span>,</span><br><span class="line">                                <span class="attr">"cluster"</span> : <span class="string">"BD"</span></span><br><span class="line">                        &#125;,</span><br><span class="line">                        <span class="attr">"tasks"</span> : [ ]</span><br><span class="line">                &#125;</span><br><span class="line">        ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><h1 id="Temporary-note"><a href="#Temporary-note" class="headerlink" title="Temporary note"></a>Temporary note</h1><p>join &amp; avoid join   <a href="https://docs.mongodb.com/manual/reference/database-references/" target="_blank" rel="noopener">https://docs.mongodb.com/manual/reference/database-references/</a></p>
<hr>
<hr>
<p>title: Mongo Note</p>
<h2 id="categories"><a href="#categories" class="headerlink" title="categories: []"></a>categories: []</h2><p>Notice</p>
<ol>
<li>provide both json and mongoengine example</li>
<li>data model and design pattern</li>
<li>index</li>
<li>lock &amp; atomic operation</li>
<li>query over reference, across collections?</li>
<li>sharded?</li>
</ol>
<p><a href="https://docs.mongodb.com/manual/data-modeling/" target="_blank" rel="noopener">https://docs.mongodb.com/manual/data-modeling/</a></p>
<p><a href="https://docs.mongodb.com/manual/core/data-model-operations/#data-model-atomicity" target="_blank" rel="noopener">Operational Factors and Data Models</a></p>
<h1 id="Document-Relationship"><a href="#Document-Relationship" class="headerlink" title="Document Relationship"></a>Document Relationship</h1><ul>
<li>embeded document: improve retrive performance</li>
<li>document reference: reduce repeatition of document</li>
</ul>
<p>one2one<br>one2many<br>many2many</p>
<p>join query?</p>
<h2 id="One-to-One"><a href="#One-to-One" class="headerlink" title="One to One"></a>One to One</h2><h2 id="Model-Tree-Structures"><a href="#Model-Tree-Structures" class="headerlink" title="Model Tree Structures"></a>Model Tree Structures</h2><p><a href="https://docs.mongodb.com/manual/applications/data-models/" target="_blank" rel="noopener">https://docs.mongodb.com/manual/applications/data-models/</a></p>
<p><a href="https://docs.mongodb.com/manual/tutorial/model-tree-structures-with-child-references/" target="_blank" rel="noopener">create index on array field</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.categories.createIndex( &#123; children: 1 &#125; )</span><br></pre></td></tr></table></figure></p>
<h2 id="join-amp-avoid-join"><a href="#join-amp-avoid-join" class="headerlink" title="join &amp; avoid join"></a>join &amp; avoid join</h2><p><a href="https://docs.mongodb.com/manual/reference/database-references/" target="_blank" rel="noopener">https://docs.mongodb.com/manual/reference/database-references/</a></p>
<hr>
<p>其他临时的记录</p>
<h1 id="Overview-Limit"><a href="#Overview-Limit" class="headerlink" title="Overview/Limit"></a>Overview/Limit</h1><blockquote>
<p><a href="https://docs.mongodb.com/manual/reference/limits/#mongodb-limits-and-thresholds" target="_blank" rel="noopener">https://docs.mongodb.com/manual/reference/limits/#mongodb-limits-and-thresholds</a></p>
</blockquote>
<ul>
<li>storage capacity of a single mongodb and sharding mongodb</li>
<li>max capacity of a single doc, collection and db</li>
<li>read &amp; write performance: latency, throughput</li>
<li>usage scenario</li>
</ul>
<blockquote>
<p><a href="https://www.mongodb.com/blog/post/thinking-documents-part-1?jmp=docs&amp;_ga=2.238184258.318970262.1525591177-1340608169.1525101104" target="_blank" rel="noopener">how to join in mongodb</a><br>reference, embedded</p>
</blockquote>
<table>
<thead>
<tr>
<th>RDBMS</th>
<th>MongoDB</th>
</tr>
</thead>
<tbody>
<tr>
<td>Database</td>
<td>Database</td>
</tr>
<tr>
<td>Table</td>
<td>Collection</td>
</tr>
<tr>
<td>Row</td>
<td>Document</td>
</tr>
<tr>
<td>Index</td>
<td>Index</td>
</tr>
<tr>
<td>JOIN</td>
<td>Embedded Document or Reference</td>
</tr>
</tbody>
</table>
<hr>
<h1 id="Data-model-and-pattern"><a href="#Data-model-and-pattern" class="headerlink" title="Data model and pattern"></a>Data model and pattern</h1><blockquote>
<p><a href="https://docs.mongodb.com/manual/core/data-model-operations/" target="_blank" rel="noopener">Operational Factors and Data Models</a></p>
</blockquote>
<ul>
<li>document structure: references &amp; embedded document</li>
<li>write operations are atomic at the document level</li>
<li>document growth, <a href="https://docs.mongodb.com/manual/core/data-model-operations/#data-model-document-growth" target="_blank" rel="noopener">MMAPv1</a></li>
<li>data use and performance: <a href="https://docs.mongodb.com/manual/core/capped-collections/" target="_blank" rel="noopener">Capped Collections</a>, use index for frequent read operation</li>
</ul>
<h3 id="Operational-Factors-and-Data-Models"><a href="#Operational-Factors-and-Data-Models" class="headerlink" title="Operational Factors and Data Models"></a>Operational Factors and Data Models</h3><ul>
<li>Document Growth</li>
<li>Atomicity</li>
<li>Sharding</li>
<li>Indexes</li>
<li>Large Number of Collections</li>
<li>Collection Contains Large Number of Small Documents</li>
<li>Storage Optimization for Small Documents</li>
<li>Data Lifecycle Management</li>
</ul>
<h1 id="Design-model-pattern"><a href="#Design-model-pattern" class="headerlink" title="Design model, pattern"></a>Design model, pattern</h1><p><a href="https://docs.mongodb.com/manual/data-modeling/" target="_blank" rel="noopener">https://docs.mongodb.com/manual/data-modeling/</a></p>
<p><a href="https://docs.mongodb.com/manual/core/data-model-design/#data-modeling-embedding" target="_blank" rel="noopener">https://docs.mongodb.com/manual/core/data-model-design/#data-modeling-embedding</a></p>
<h1 id="Index-1"><a href="#Index-1" class="headerlink" title="Index"></a>Index</h1><p><a href="https://docs.mongodb.com/manual/indexes/" target="_blank" rel="noopener">https://docs.mongodb.com/manual/indexes/</a></p>
<p>what is index in mongo? index for different field type: array?</p>
<p>how to create index?</p>
<p>index overhead, performance penalization ?</p>
<p>mongo index is implemented based on B tree, thus, it’s ordered</p>
<p>[interview] b+,b-,lsm comparison</p>
<h1 id="Shard-1"><a href="#Shard-1" class="headerlink" title="Shard"></a>Shard</h1><p><a href="https://docs.mongodb.com/manual/reference/glossary/#term-chunk" target="_blank" rel="noopener">https://docs.mongodb.com/manual/reference/glossary/#term-chunk</a></p>
<p><a href="https://docs.mongodb.com/manual/sharding/" target="_blank" rel="noopener">https://docs.mongodb.com/manual/sharding/</a></p>
<p><a href="https://docs.mongodb.com/manual/core/sharding-shard-key/" target="_blank" rel="noopener">https://docs.mongodb.com/manual/core/sharding-shard-key/</a></p>
<p>shard architecture?</p>
<p>chunks (default to 64MB) —&gt; shard </p>
<p>index and shard key</p>
<p>how to route data based on the shard key?</p>
<p>load balance and migration based on chunk</p>
<h1 id="Atomic-operation-1"><a href="#Atomic-operation-1" class="headerlink" title="Atomic operation"></a>Atomic operation</h1><blockquote>
<p><a href="https://docs.mongodb.com/manual/core/data-model-operations/#data-model-atomicity" target="_blank" rel="noopener">https://docs.mongodb.com/manual/core/data-model-operations/#data-model-atomicity</a></p>
</blockquote>
<p>Are atomic on the level of a single document.</p>
<p>embedding the available field and the checkout field within the same document ensures that you can update the two fields atomically.</p>
<h1 id="Performance-1"><a href="#Performance-1" class="headerlink" title="Performance"></a>Performance</h1><p><a href="https://docs.mongodb.com/manual/core/data-model-operations/#data-model-atomicity" target="_blank" rel="noopener">https://docs.mongodb.com/manual/core/data-model-operations/#data-model-atomicity</a></p>
<p><a href="https://docs.mongodb.com/manual/core/capped-collections/" target="_blank" rel="noopener">https://docs.mongodb.com/manual/core/capped-collections/</a></p>
<p><a href="https://stackoverflow.com/questions/2811299/mongodb-index-ram-relationship?utm_medium=organic&amp;utm_source=google_rich_qa&amp;utm_campaign=google_rich_qa" target="_blank" rel="noopener">https://stackoverflow.com/questions/2811299/mongodb-index-ram-relationship?utm_medium=organic&amp;utm_source=google_rich_qa&amp;utm_campaign=google_rich_qa</a></p>
<p><a href="http://jasonwilder.com/blog/2012/02/08/optimizing-mongodb-indexes/" target="_blank" rel="noopener">http://jasonwilder.com/blog/2012/02/08/optimizing-mongodb-indexes/</a></p>
<p><a href="https://docs.mongodb.com/manual/tutorial/ensure-indexes-fit-ram/" target="_blank" rel="noopener">https://docs.mongodb.com/manual/tutorial/ensure-indexes-fit-ram/</a></p>
<ul>
<li>index</li>
<li>capped collections: update &amp; index &amp; avoid scan; </li>
<li>use reference to reduce space usage</li>
</ul>
<hr>
<h1 id="Example-1"><a href="#Example-1" class="headerlink" title="Example"></a>Example</h1><p><strong>find + forEach</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.clothes.find( &#123; $and : [ &#123; price: &#123; $exists: true &#125; &#125;, &#123; price: &#123; $type: &quot;string&quot; &#125; &#125; ] &#125; ).forEach( function( doc ) &#123;</span><br><span class="line">  doc.priceDec = NumberDecimal( doc.price );</span><br><span class="line">  db.clothes.save( doc );</span><br><span class="line">&#125; );</span><br></pre></td></tr></table></figure></p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">YYY</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://yoursite.com/2018/05/07/mongo/">http://yoursite.com/2018/05/07/mongo/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/blog/tags/mongodb/">mongodb</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/blog/2018/05/13/2017-03-27-Yarn-FS/"><i class="fa fa-chevron-left">  </i><span>Yarn FS</span></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2015 - 2018 By YYY</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="/blog/js/third-party/anime.min.js"></script><script src="/blog/js/third-party/jquery.min.js"></script><script src="/blog/js/third-party/jquery.fancybox.min.js"></script><script src="/blog/js/third-party/velocity.min.js"></script><script src="/blog/js/third-party/velocity.ui.min.js"></script><script src="/blog/js/utils.js?version=1.5.4"></script><script src="/blog/js/fancybox.js?version=1.5.4"></script><script src="/blog/js/sidebar.js?version=1.5.4"></script><script src="/blog/js/copy.js?version=1.5.4"></script><script src="/blog/js/fireworks.js?version=1.5.4"></script><script src="/blog/js/transition.js?version=1.5.4"></script><script src="/blog/js/scroll.js?version=1.5.4"></script><script src="/blog/js/head.js?version=1.5.4"></script></body></html>